version: "3.8"
services:
  web:
    image: node:18
    container_name: jetson-web
    working_dir: /app
    network_mode: host
    environment:
      - PORT=80
      - JETSON_ONLY=true
      - DEEPSTREAM_IMAGE=nvcr.io/nvidia/deepstream-l4t:6.0.1-samples
      - DS_APP_IMAGE=nvcr.io/nvidia/deepstream-l4t:6.0.1-samples
    restart: unless-stopped
    command: bash -lc "node server.js"
    volumes:
      - ./jetson-web:/app
      - ./jetson-web/node_modules:/app/node_modules
      - /var/run/docker.sock:/var/run/docker.sock
      - /data/hls:/app/public/video
      - /data/hls:/data/hls
      - /data/videos:/data/videos
      - /data/ds/configs:/app/configs
      - /data/ds/configs:/data/ds/configs
      - /data/snapshots:/data/snapshots
      - /opt/nvidia/deepstream/deepstream-6.0/sources/libs/nvdsinfer_custom_impl:/opt/nvidia/deepstream/deepstream-6.0/sources/libs/nvdsinfer_custom_impl
  spec:
    image: nginx:alpine
    container_name: openapi-spec
    restart: unless-stopped
    ports:
      - "80:80"
    volumes:
      - ./jetson-web/openapi.json:/usr/share/nginx/html/openapi.json:ro
      - ./nginx/openapi.conf:/etc/nginx/conf.d/default.conf:ro